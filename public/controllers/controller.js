(function(){
  var app = angular.module("MyApp",[]);

  MyController = app.controller("MyController", ['$scope', '$http', '$interval', function($scope, $http, $interval){

    // Initialize variables:
    $scope.timeRemaining = 2;
    $scope.currentRecord = {
      start:"", end:""
    };
    // $scope.currentRecord.start = "";
    
    console.log("hello from controller.js");
    
    var refresh = function() {
      $http.get('/typespeed').success(function(response) {
        console.log("Success function fired!");

        // Find the "response" object generated by server.js's routes
        // Remember to restart server!!!
        $scope.testdata = response;
      }); // End GET function
      console.log("Refresh function is running!");
    } // Enclose the GET function in a function

    refresh();

    $scope.addContact = function() {
      console.log("You entered this info: " +$scope.contact);

      $http.post('/typespeed', $scope.contact).success(function(response) {
        console.log("Success function running!" +response);
        refresh();
      }); // end POST function
    }; // end addContact function

    var stopCountDown = function() {
      $interval.cancel(countDown);
      $scope.currentRecord.end = (new Date()).getTime();
    };

    var decreaseTime = function() {
      $scope.timeRemaining --;
      if ($scope.timeRemaining == 0) {
        stopCountDown();
      }
    };
    countDown = $interval(decreaseTime,1000);

    $scope.resetTime = function() {
      $scope.timeRemaining = 2;
      if ($scope.currentRecord.start == "") {
        $scope.currentRecord.start = (new Date()).getTime();
      }
      console.log("The start time is " +$scope.currentRecord.start);
    } // resetTime
  
  }]); // End controller

})(); // Whole function closure